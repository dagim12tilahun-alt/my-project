<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Automatic SMS Visualizer</title>
    <style>
        body, html {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            background-color: black; /* Starts black to hide UI */
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        #display {
            width: 100vw;
            height: 100vh;
        }
    </style>
</head>
<body>

    <div id="display"></div>

    <script>
        // Mapping letters to colors
        const colors = {
            'a': 'red',
            'b': 'blue',
            'c': 'green',
            'd': 'yellow',
            'e': 'purple'
        };

        const sleep = ms => new Promise(res => setTimeout(res, ms));

        window.onload = async function() {
            // 1. Get the SMS text from the URL (?msg=...) passed by MacroDroid
            const params = new URLSearchParams(window.location.search);
            const smsText = params.get('msg');

            if (smsText) {
                const display = document.getElementById('display');
                
                // 2. Process only letters a-e
                const sequence = smsText.toLowerCase()
                                        .split('')
                                        .filter(char => char >= 'a' && char <= 'e');

                // 3. Loop the entire process 3 times
                for (let i = 0; i < 3; i++) {
                    for (let letter of sequence) {
                        // Display Letter Color
                        display.style.backgroundColor = colors[letter];
                        await sleep(2000);

                        // Black Separator
                        display.style.backgroundColor = 'black';
                        await sleep(500); 
                    }

                    // 4. 2-second White Light at the end of the sequence
                    display.style.backgroundColor = 'white';
                    await sleep(2000);

                    // Return to black before next loop or finish
                    display.style.backgroundColor = 'black';
                    await sleep(500);
                }

                // 5. Clear data/Reset screen
                display.style.backgroundColor = 'black';
                console.log("Sequence complete. Waiting for new input.");
            }
        };
    </script>
</body>
</html>
