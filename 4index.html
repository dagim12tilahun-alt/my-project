<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Virtual Keyboard App</title>
    <style>
        body, html {
            margin: 0; padding: 0; width: 100%; height: 100%;
            overflow: hidden; background-color: #121212; color: white;
            font-family: Arial, sans-serif; display: flex;
            flex-direction: column; align-items: center; justify-content: center;
        }

        #ui-container { text-align: center; width: 100%; }

        input {
            padding: 15px; font-size: 1.2rem; width: 80%;
            border-radius: 8px; border: 2px solid #3498db; margin-bottom: 20px;
            background: #222; color: white; text-align: center;
        }

        /* Virtual Keyboard Styling */
        .keyboard {
            display: flex; justify-content: center; gap: 15px; margin-top: 20px;
        }

        .key {
            width: 70px; height: 70px; background: #444;
            border-radius: 10px; display: flex; align-items: center;
            justify-content: center; font-weight: bold; font-size: 1.2rem;
            box-shadow: 0 4px #222; cursor: pointer; user-select: none;
        }

        .key:active { transform: translateY(4px); box-shadow: 0 0px #222; background: #666; }
        .key.active { background: #3498db; color: white; } /* Highlight for Ctrl */

        #display-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            display: none; z-index: 100;
        }
    </style>
</head>
<body>

    <div id="ui-container">
        <h1>Virtual Keyboard App</h1>
        <input type="text" id="userInput" placeholder="Wait for Paste..." readonly>
        
        <div class="keyboard">
            <div class="key" id="ctrlKey" onclick="toggleCtrl()">CTRL</div>
            <div class="key" onclick="pressV()">V</div>
        </div>
        <p id="status">Tap CTRL then tap V</p>
    </div>

    <div id="display-overlay"></div>

    <script>
        let isCtrlPressed = false;
        const inputField = document.getElementById('userInput');
        const overlay = document.getElementById('display-overlay');
        const ctrlBtn = document.getElementById('ctrlKey');

        // 1. Function to handle the Virtual CTRL toggle - NOW LOCKS ON CLICK
        function toggleCtrl() {
            isCtrlPressed = true; // Lock it to true
            ctrlBtn.classList.add('active'); // Keep the blue highlight
        }

        // 2. Function to handle the Virtual V press
        async function pressV() {
            if (isCtrlPressed) {
                try {
                    // This mimics the Paste action
                    const text = await navigator.clipboard.readText();
                    inputField.value = text;
                    
                    // Note: I removed the reset lines here so it stays locked even after paste
                    
                    // Start the color process
                    startProcess();
                } catch (err) {
                    alert("Permission denied. Please tap the input box and paste manually if this fails.");
                }
            } else {
                alert("You must tap CTRL first to perform a paste!");
            }
        }

        const colorMap = { 'A': 'red', 'B': 'green', 'C': 'blue', 'D': 'yellow', 'E': 'purple' };

        async function startProcess() {
            const text = inputField.value.toUpperCase();
            const filteredChars = text.split('').filter(char => ['A', 'B', 'C', 'D', 'E'].includes(char));
            
            if (filteredChars.length === 0) return;

            document.getElementById('ui-container').style.display = 'none';
            overlay.style.display = 'block';

            for (let i = 0; i < 3; i++) {
                for (let char of filteredChars) {
                    overlay.style.backgroundColor = colorMap[char];
                    await sleep(2000);
                    overlay.style.backgroundColor = 'black';
                    await sleep(500);
                }
                overlay.style.backgroundColor = 'white';
                await sleep(3000);
            }

            overlay.style.display = 'none';
            document.getElementById('ui-container').style.display = 'block';
            inputField.value = ""; 
        }

        function sleep(ms) { return new Promise(r => setTimeout(r, ms)); }
    </script>
</body>
</html>
